include(ExternalProject)

set(GLEW_VERSION            2.2.0)
set(GLEW_INSTALL_DIR        "${CMAKE_BINARY_DIR}/_vendor")
set(GLEW_INCLUDE_DIRECTORY  "${GLEW_INSTALL_DIR}/include")
set(GLEW_LIBRARY_DIRECTORY  "${GLEW_INSTALL_DIR}/lib")

file(MAKE_DIRECTORY "${GLEW_INCLUDE_DIRECTORY}")
file(MAKE_DIRECTORY "${GLEW_LIBRARY_DIRECTORY}")

if (WIN32)
    set(GLEW_IMPORTED_LOCATION_DEBUG    "${GLEW_INSTALL_DIR}/bin/${CMAKE_SHARED_LIBRARY_PREFIX}glew32d${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(GLEW_IMPORTED_IMPLIB_DEBUG      "${GLEW_INSTALL_DIR}/lib/${CMAKE_IMPORT_LIBRARY_PREFIX}glew32d${CMAKE_IMPORT_LIBRARY_SUFFIX}")
    set(GLEW_IMPORTED_LOCATION          "${GLEW_INSTALL_DIR}/bin/${CMAKE_SHARED_LIBRARY_PREFIX}glew32${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(GLEW_IMPORTED_IMPLIB            "${GLEW_INSTALL_DIR}/lib/${CMAKE_IMPORT_LIBRARY_PREFIX}glew32${CMAKE_IMPORT_LIBRARY_SUFFIX}")
else()
    set(GLEW_IMPORTED_LOCATION_DEBUG    "${GLEW_INSTALL_DIR}/lib/${CMAKE_SHARED_LIBRARY_PREFIX}GLEWd${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(GLEW_IMPORTED_LOCATION          "${GLEW_INSTALL_DIR}/lib/${CMAKE_SHARED_LIBRARY_PREFIX}GLEW${CMAKE_SHARED_LIBRARY_SUFFIX}")
endif()

ExternalProject_Add(
    ep_glew
    URL             "https://github.com/nigels-com/glew/releases/download/glew-${GLEW_VERSION}/glew-${GLEW_VERSION}.tgz"
    INSTALL_DIR     "${GLEW_INSTALL_DIR}"
    SOURCE_SUBDIR   "build/cmake"
    CMAKE_ARGS
        "-DCMAKE_BUILD_TYPE=$<CONFIG>"
        "-DCMAKE_INSTALL_PREFIX=<INSTALL_DIR>"
)

add_library(GLEW::GLEW SHARED IMPORTED GLOBAL)
set_target_properties(
    GLEW::GLEW
    PROPERTIES

    INTERFACE_INCLUDE_DIRECTORIES   "${GLEW_INCLUDE_DIRECTORY}"
    IMPORTED_LOCATION_DEBUG         "${GLEW_IMPORTED_LOCATION_DEBUG}"
    IMPORTED_LOCATION               "${GLEW_IMPORTED_LOCATION}"
    IMPORTED_IMPLIB_DEBUG           "${GLEW_IMPORTED_IMPLIB_DEBUG}"
    IMPORTED_IMPLIB                 "${GLEW_IMPORTED_IMPLIB}"
)
add_dependencies(GLEW::GLEW ep_glew)
