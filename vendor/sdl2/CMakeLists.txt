include(ExternalProject)

set(SDL2_VERSION            2.0.10)
set(SDL2_INSTALL_DIR        "${CMAKE_BINARY_DIR}/_vendor")
set(SDL2_INCLUDE_DIRECTORY  "${SDL2_INSTALL_DIR}/include")
set(SDL2_LIBRARY_DIRECTORY  "${SDL2_INSTALL_DIR}/lib")

file(MAKE_DIRECTORY "${SDL2_INCLUDE_DIRECTORY}")
file(MAKE_DIRECTORY "${SDL2_LIBRARY_DIRECTORY}")

if (WIN32)
    set(SDL2_IMPORTED_LOCATION              "${SDL2_INSTALL_DIR}/bin/${CMAKE_SHARED_LIBRARY_PREFIX}SDL2${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(SDL2_IMPORTED_LOCATION_DEBUG        "${SDL2_INSTALL_DIR}/bin/${CMAKE_SHARED_LIBRARY_PREFIX}SDL2d${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(SDL2_IMPORTED_IMPLIB                "${SDL2_INSTALL_DIR}/lib/${CMAKE_IMPORT_LIBRARY_PREFIX}SDL2${CMAKE_IMPORT_LIBRARY_SUFFIX}")
    set(SDL2_IMPORTED_IMPLIB_DEBUG          "${SDL2_INSTALL_DIR}/lib/${CMAKE_IMPORT_LIBRARY_PREFIX}SDL2d${CMAKE_IMPORT_LIBRARY_SUFFIX}")
    set(SDL2MAIN_IMPORTED_LOCATION          "${SDL2_INSTALL_DIR}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}SDL2main${CMAKE_STATIC_LIBRARY_SUFFIX}")
    set(SDL2MAIN_IMPORTED_LOCATION_DEBUG    "${SDL2_INSTALL_DIR}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}SDL2maind${CMAKE_STATIC_LIBRARY_SUFFIX}")
else()
    set(SDL2_IMPORTED_LOCATION              "${SDL2_INSTALL_DIR}/lib/${CMAKE_SHARED_LIBRARY_PREFIX}SDL2${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(SDL2_IMPORTED_LOCATION_DEBUG        "${SDL2_INSTALL_DIR}/lib/${CMAKE_SHARED_LIBRARY_PREFIX}SDL2d${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(SDL2MAIN_IMPORTED_LOCATION          "${SDL2_INSTALL_DIR}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}SDL2main${CMAKE_STATIC_LIBRARY_SUFFIX}")
    set(SDL2MAIN_IMPORTED_LOCATION_DEBUG    "${SDL2_INSTALL_DIR}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}SDL2maind${CMAKE_STATIC_LIBRARY_SUFFIX}")
endif()

ExternalProject_Add(
    ep_sdl2
    URL             "https://libsdl.org/release/SDL2-${SDL2_VERSION}.tar.gz"
	INSTALL_DIR     "${SDL2_INSTALL_DIR}"
    CMAKE_ARGS
        "-DCMAKE_BUILD_TYPE=$<CONFIG>"
		"-DCMAKE_INSTALL_PREFIX=<INSTALL_DIR>"
        "-DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}"
        "-DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}"
)

add_library(SDL2::SDLmain STATIC IMPORTED GLOBAL)
set_target_properties(
    SDL2::SDLmain
    PROPERTIES
    IMPORTED_LOCATION               "${SDL2MAIN_IMPORTED_LOCATION}"
    IMPORTED_LOCATION_DEBUG         "${SDL2MAIN_IMPORTED_LOCATION_DEBUG}"
)

add_library(SDL2::SDL SHARED IMPORTED GLOBAL)
set_target_properties(
    SDL2::SDL
    PROPERTIES
    INTERFACE_INCLUDE_DIRECTORIES   "${SDL2_INCLUDE_DIRECTORY}"
    IMPORTED_LOCATION               "${SDL2_IMPORTED_LOCATION}"
    IMPORTED_LOCATION_DEBUG         "${SDL2_IMPORTED_LOCATION_DEBUG}"
    IMPORTED_IMPLIB                 "${SDL2_IMPORTED_IMPLIB}"
    IMPORTED_IMPLIB_DEBUG           "${SDL2_IMPORTED_IMPLIB_DEBUG}"
    INTERFACE_LINK_LIBRARIES        "SDL2::SDLmain"
)
add_dependencies(SDL2::SDL ep_sdl2)
