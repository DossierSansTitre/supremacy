include(ExternalProject)

set(ZLIB_VERSION            1.2.11)
set(ZLIB_INSTALL_DIR        "${CMAKE_BINARY_DIR}/_vendor")
set(ZLIB_INCLUDE_DIRECTORY  "${ZLIB_INSTALL_DIR}/include")
set(ZLIB_LIBRARY_DIRECTORY  "${ZLIB_INSTALL_DIR}/lib")

file(MAKE_DIRECTORY "${ZLIB_INCLUDE_DIRECTORY}")
file(MAKE_DIRECTORY "${ZLIB_LIBRARY_DIRECTORY}")

if (WIN32)
    set(ZLIB_IMPORTED_LOCATION_DEBUG    "${ZLIB_INSTALL_DIR}/bin/${CMAKE_SHARED_LIBRARY_PREFIX}zlibd${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(ZLIB_IMPORTED_IMPLIB_DEBUG      "${ZLIB_INSTALL_DIR}/lib/${CMAKE_IMPORT_LIBRARY_PREFIX}zlibd${CMAKE_IMPORT_LIBRARY_SUFFIX}")
    set(ZLIB_IMPORTED_LOCATION          "${ZLIB_INSTALL_DIR}/bin/${CMAKE_SHARED_LIBRARY_PREFIX}zlib${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(ZLIB_IMPORTED_IMPLIB            "${ZLIB_INSTALL_DIR}/lib/${CMAKE_IMPORT_LIBRARY_PREFIX}zlib${CMAKE_IMPORT_LIBRARY_SUFFIX}")
else()
    set(ZLIB_IMPORTED_LOCATION          "${ZLIB_INSTALL_DIR}/lib/${CMAKE_SHARED_LIBRARY_PREFIX}z${CMAKE_SHARED_LIBRARY_SUFFIX}")
    set(ZLIB_IMPORTED_LOCATION_DEBUG    "${ZLIB_IMPORTED_LOCATION}")
endif()

ExternalProject_Add(
    ep_zlib
    URL             "https://zlib.net/zlib-${ZLIB_VERSION}.tar.gz"
    INSTALL_DIR     "${ZLIB_INSTALL_DIR}"
    CMAKE_ARGS
        "-DCMAKE_BUILD_TYPE=$<CONFIG>"
        "-DCMAKE_INSTALL_PREFIX=<INSTALL_DIR>"
)

add_library(ZLIB::ZLIB SHARED IMPORTED GLOBAL)
set_target_properties(
    ZLIB::ZLIB
    PROPERTIES

    INTERFACE_INCLUDE_DIRECTORIES   "${ZLIB_INCLUDE_DIRECTORY}"
    IMPORTED_LOCATION_DEBUG         "${ZLIB_IMPORTED_LOCATION_DEBUG}"
    IMPORTED_LOCATION               "${ZLIB_IMPORTED_LOCATION}"
    IMPORTED_IMPLIB_DEBUG           "${ZLIB_IMPORTED_IMPLIB_DEBUG}"
    IMPORTED_IMPLIB                 "${ZLIB_IMPORTED_IMPLIB}"
)
add_dependencies(ZLIB::ZLIB ep_zlib)
